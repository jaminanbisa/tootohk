/*! tooto-pro - v3.11.6 - 14-03-2023 */
"use strict";(self.webpackChunktooto_pro=self.webpackChunktooto_pro||[]).push([[156],{7121:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;class StripeHandler extends tootoModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{form:".tooto-stripe-form",errors:".tooto-message-danger"}}}getDefaultElements(){const e=this.getSettings();return{form:this.$element[0].querySelector(e.selectors.form),errors:this.$element[0].querySelectorAll(e.selectors.errors),post_id:this.$element.closest("[data-tooto-id]").attr("data-tooto-id")}}handleSubmit(e){if(e.preventDefault(),tootoFrontend.isEditMode())return;""!==this.elements.errors.innerHTML&&document.querySelectorAll(".tooto-stripe-error-message").forEach((e=>e.remove()));const t=this.elements.form,r=new FormData(t),s=r.get("url"),o=r.get("action"),n=parseInt(this.elements.post_id),l=r.get("widget_id"),a=r.get("custom_error_msg"),m=r.get("custom_error_msg_global"),i=r.get("custom_error_msg_payment"),d=r.get("stripe_form_submit_nonce"),c=document.URL,u="yes"===r.get("open_in_new_window")?"_blank":"_self",createErrorContainer=e=>{const r=document.createElement("div"),s=t.appendChild(r);s.className="tooto-message tooto-stripe-error-message tooto-message-danger",s.innerHTML=e},g={action:o,postId:n,widgetId:l,pageUrl:c,nonce:d};0<this.elements.errors.length?this.elements.errors.forEach((e=>{e.classList.remove("tooto-hidden")})):jQuery.post(s,{action:o,data:g}).done((e=>{const t=e.response.code,r=e.body&&JSON.parse(e.body);switch(t){case 200:window.open(r.url,u);break;case 401:case 403:createErrorContainer(a?i:r.error.message);break;default:createErrorContainer(a?m:r.error.message)}})).fail((()=>{createErrorContainer(a?m:result.error.message)}))}bindEvents(){this.elements.form.addEventListener("submit",(e=>this.handleSubmit(e)))}}t.default=StripeHandler}}]);